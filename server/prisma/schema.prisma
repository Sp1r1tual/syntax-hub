generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                    String           @id @default(uuid())
  email                 String           @unique
  name                  String?
  avatar                String?
  roles                 UserRole[]
  refreshTokens         RefreshToken[]
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt

  @@map("users")
}

model Role {
  id                    String           @id @default(uuid())
  key                   String           @unique 
  title                 String
  users                 UserRole[]
  createdAt             DateTime         @default(now())

  @@map("roles")
}

model UserRole {
  userId String
  roleId String
  user                  User             @relation(fields: [userId],            references: [id], onDelete: Cascade)
  role                  Role             @relation(fields: [roleId],            references: [id], onDelete: Cascade)
  
  @@id([userId, roleId])
  @@map("user_roles")
}

model RefreshToken {
  id                    String            @id @default(uuid())
  token                 String            @unique
  userId                String
  user                  User              @relation(fields: [userId],           references: [id], onDelete: Cascade)
  expiresAt             DateTime
  createdAt             DateTime          @default(now())

  @@map("refresh_tokens")
}

model CourseCategory {
  id                    String            @id @default(uuid())
  key                   String            @unique 
  title                 String           
  order                 Int               @default(999)
  icon                  String?
  courses               Course[]
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  @@index([order])
  @@map("course_categories")
}

model Course {
  id                    String            @id @default(uuid())
  slug                  String            @unique
  categoryId            String
  category              CourseCategory    @relation(fields: [categoryId],       references: [id], onDelete: Restrict)
  title                 String
  description           String?
  topics                Topic[]
  icon                  String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  @@index([categoryId])
  @@map("courses")
}

model Topic {
  id                    String            @id @default(uuid())
  title                 String
  courseId              String
  course                Course            @relation(fields: [courseId],          references: [id], onDelete: Cascade)
  questions             Question[]
  order                 Int               @default(999)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  @@index([courseId])
  @@map("topics")
}

model Question {
  id                    String            @id @default(uuid())
  text                  String            @db.Text
  topicId               String
  topic                 Topic             @relation(fields: [topicId],           references: [id], onDelete: Cascade)
  explanation           String            @db.Text
  order                 Int               @default(999)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  @@index([topicId])
  @@map("questions")
}